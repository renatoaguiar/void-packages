# Template file for 'vmm_clock'
pkgname=vmm_clock
version=0.0.20201213
revision=1
_commit=f9c81a6eb058af6f18adf85a9d1dcd2f11201975
wrksrc=vmm_clock-${_commit}
depends="dkms"
short_desc="Clocksource implementation for OpenBSD VMM guests"
maintainer="Renato Aguiar <renato@renatoaguiar.net>"
license="GPL-2.0-only"
homepage="https://github.com/voutilad/vmm_clock"
distfiles="https://github.com/voutilad/vmm_clock/archive/${_commit}.tar.gz"
checksum=8dd7415ef0c79a7591c0ec8eda80004ab7d8baab4249d789477774ed767baa07
dkms_modules="vmm_clock ${version}"

do_install() {
	vmkdir usr/src/vmm_clock-${version}
	vcopy "*.c" usr/src/vmm_clock-${version}
	vcopy "*.h" usr/src/vmm_clock-${version}
	vcopy Makefile usr/src/vmm_clock-${version}
	vcopy Kconfig usr/src/vmm_clock-${version}
	vcopy Kbuild usr/src/vmm_clock-${version}
	vinstall ${FILESDIR}/dkms.conf 644 usr/src/vmm_clock-${version}
	sed -i -e "s/@VERSION@/${version}/" ${PKGDESTDIR}/usr/src/vmm_clock-${version}/dkms.conf
}
